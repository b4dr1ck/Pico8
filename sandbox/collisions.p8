pico-8 cartridge // http://www.pico-8.com
version 16
__lua__



function collision(x1,y1,x2,y2,offset_l,offset_r,offset_u,offset_d)
    if  x1 + offset_l <= x2 + 7 and
        x1 + 7 - offset_r>= x2 and
        y1 + offset_u <= y2 + 7 and
        y1 + 7 - offset_d >= y2
    then
        return true
    else
        return false
    end
end


function _init()
    player={}
    player.x=24
    player.y=24
    hspeed=0
    vspeed=0

    solid={}
    solid.x=64
    solid.y=64

    collision_detection=false
    coll_offset_up=0
    coll_offset_down=4
    coll_offset_left=0
    coll_offset_right=0
end


function _update()

    -- movement left 
    if btn(0) then
        hspeed=-1
    end
    -- movement right 
    if btn(1) then
        hspeed=1
    end

    player.x += hspeed

    -- collision left
    if      fget(mget(flr((player.x+coll_offset_left)/8), flr((player.y+coll_offset_up)/8 ))) == 1  or
            fget(mget(flr((player.x+coll_offset_left)/8), flr((player.y + 7-coll_offset_down)/8 ))) == 1
    then
            player.x = (ceil(player.x/8) * 8) - coll_offset_left
    -- collision right
    elseif  fget(mget(flr((player.x + 7-coll_offset_right)/8), flr((player.y+coll_offset_up)/8 ))) == 1  or
            fget(mget(flr((player.x + 7-coll_offset_right)/8), flr((player.y + 7-coll_offset_down)/8 ))) == 1
    then
            player.x = (flr(player.x/8) * 8) + coll_offset_right
    end

    if collision(player.x+hspeed,player.y,solid.x,solid.y,coll_offset_left,coll_offset_right,coll_offset_up,coll_offset_down) 
    then
        if hspeed > 0 then
            player.x = (flr(player.x/8) * 8) + coll_offset_right
        else
            player.x = (ceil(player.x/8) * 8) - coll_offset_left
        end
    end

    -- movement up 
    if btn(2) then
        vspeed = -1
    end
    -- movement down 
    if btn(3) then
        vspeed = 1
    end

    player.y += vspeed

    -- collision up
    if      fget(mget(flr((player.x+coll_offset_left)/8), flr((player.y+coll_offset_up)/8 ))) == 1  or
            fget(mget(flr((player.x + 7-coll_offset_right)/8), flr((player.y+coll_offset_up)/8 ))) == 1
    then
            player.y = ceil(player.y/8) * 8 - coll_offset_up
    -- collision down
    elseif  fget(mget(flr((player.x + coll_offset_left)/8), flr((player.y + 7-coll_offset_down)/8 ))) == 1  or
            fget(mget(flr((player.x + 7-coll_offset_right)/8), flr((player.y + 7-coll_offset_down)/8 ))) == 1
    then
            player.y = flr(player.y/8) * 8 + coll_offset_down
    end

    if collision(player.x,player.y+vspeed,solid.x,solid.y,coll_offset_left,coll_offset_right,coll_offset_up,coll_offset_down) 
    then
        if vspeed > 0 then
            player.y = (flr(player.y/8) * 8) + coll_offset_down
        else
            player.y = (ceil(player.y/8) * 8) - coll_offset_up
        end
    end

    -- stop movement
    if not btn(0) and not btn(1) then
        hspeed = 0
    end

    if not btn(2) or not btn(3) then
        vspeed = 0
    end
end

function _draw()
    cls()
    map(0,0,0,0,128,128)
    spr(2,solid.x,solid.y)
    rectfill(player.x,player.y,player.x+7,player.y+7,8)
    print(collision_detection)
end

__gfx__
00000000222222221111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222221111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070022dddd221177771100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700022dddd221177771100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700022dddd221177771100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070022dddd221177771100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000022dddd221177771100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000022dddd221177771100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000001010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
